version: '3'
services:  
  # openidm:
    # build:
      # context: .
      # dockerfile: IDM/Dockerfile
      # args:
        # djNode: openidm
    # ports:
       # - "127.0.1.3:8280:8080"
       # - "127.0.1.3:8243:8443"
    # environment:
      # node: openidm
    # volumes:
      # - c:\docker\openidm:/opt/forgerock/openidm
  opendj_usr:
    build:
      context: .
      dockerfile: DS/Dockerfile
      args:
        djNode: opendj_usr
    ports:
       - "127.0.1.4:4443:4443"
       - "127.0.1.4:1388:1388"
       - "127.0.1.4:1635:1635"
       - "127.0.1.4:8442:8442"
    environment:
      BOOTSTRAP: /opt/forgerock/opendj_usr/opendj/Bootstrap/usr/setup.sh
      host: nausawsodj601.corp.valvoline.com
      adminConnectorPort: 4443
      ldapPort: 1388
      ldapsPort: 1635
      httpsPort: 8442
      djNode: opendj_usr
    extra_hosts:
      - "nausawsodj601.corp.valvoline.com:127.0.0.1"
      - "nausawsodj601.corp.valvoline.com:0.0.0.0"
    volumes:
      - c:\docker\dj_usr:/opt/forgerock/opendj_usr/opendj/bak
  opendj_cfg:
    build:
      context: .
      dockerfile: DS/Dockerfile
      args:
        djNode: opendj_cfg
    ports:
       - "127.0.1.6:4444:4444"
       - "127.0.1.6:1389:1389"
       - "127.0.1.6:1636:1636"
       - "127.0.1.6:8443:8443"
    environment:
      BOOTSTRAP: /opt/forgerock/opendj_cfg/opendj/Bootstrap/cfg/setup.sh
      host: nausawsodj603.corp.valvoline.com
      adminConnectorPort: 4444
      ldapPort: 1389
      ldapsPort: 1636
      httpsPort: 8443
      djNode: opendj_cfg
    extra_hosts:
      - "nausawsodj603.corp.valvoline.com:127.0.0.1"
      - "nausawsodj603.corp.valvoline.com:0.0.0.0"
    volumes:
      - c:\docker\dj_cfg:/opt/forgerock/opendj_cfg/opendj/bak
  openam:
    build:
      context: .
      dockerfile: AM/Dockerfile
      args:
       https_port: 8143
    ports:
       - "127.0.1.7:8180:8080"
       - "127.0.1.7:8143:8443"
    environment:
      JAVA_OPTS: -Dport.shutdown=8005 -Dport.http=8180 -Dport.https=8143 -Daddress=127.0.1.7
      OPENAM_INSTANCE: http://nausawsoam601.corp.valvoline.com:8080
      SERVER_URI: /auth
    extra_hosts:
      - "nausawsoam601.corp.valvoline.com:127.0.0.1"
    depends_on:
      - opendj_usr
      - opendj_cfg
    links:
      - opendj_usr:nausawsodj601.corp.valvoline.com
      - opendj_cfg:nausawsodj603.corp.valvoline.com
    volumes:
      - c:\docker\am:/root/openam
      #- c:\docker\openam:/opt/forgerock/tomcat/webapps/auth
  amster:
    build:
      context: .
      dockerfile: amster/Dockerfile
    environment:
      OPENAM_INSTANCE: http://nausawsoam601.corp.valvoline.com:8080
      SERVER_URI: /auth
    depends_on:
      - openam
    links:
      - openam:nausawsoam601.corp.valvoline.com
    #volumes:
     # - c:\docker\amster:/opt/forgerock/amster